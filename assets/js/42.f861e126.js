(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{516:function(s,a,t){s.exports=t.p+"assets/img/image-20210404212419241.b9f90982.png"},517:function(s,a,t){s.exports=t.p+"assets/img/image-20210405115611359.5c4d1b27.png"},518:function(s,a,t){s.exports=t.p+"assets/img/image-20210405120356983.0f618262.png"},782:function(s,a,t){"use strict";t.r(a);var n=t(20),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx-conf-配置详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf-配置详解"}},[s._v("#")]),s._v(" nginx.conf 配置详解")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("再次说明下！")]),s._v(" "),n("p",[s._v("这些基础的东西在官方文档里面都有详细的说明 http://nginx.org/en/docs/")]),s._v(" "),n("p",[s._v("笔者就是有时候看的东西多了，某些软件的文档讲的特别的不好，所以有时候会先入为主，觉得看不懂官方文档，其实 nginx 的文档还不错，下面讲的这些在文档里面都有详细的讲解")]),s._v(" "),n("p",[s._v("nginx 中的指令都可以在这个 "),n("a",{attrs:{href:"http://nginx.org/en/docs/dirindex.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方页面"),n("OutboundLink")],1),s._v(" 中找到")])]),s._v(" "),n("h2",{attrs:{id:"nginx-conf-文件结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf-文件结构"}},[s._v("#")]),s._v(" nginx.conf 文件结构")]),s._v(" "),n("p",[n("img",{attrs:{src:t(516),alt:"image-20210404212419241"}})]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 一条指令，由分号结尾\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 花括号的为指令块，里面包含多个指令块\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 由 $ 符号开头的是 nginx 内置的一些变量\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" log_format main "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr ....'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 指令之间由至少一个空格进行分割\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 也可以使用 tap，一个 tap 表示 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 个空格，但是一般使用 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 个空格缩进比较好\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h2",{attrs:{id:"指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指令详解"}},[s._v("#")]),s._v(" 指令详解")]),s._v(" "),n("p",[s._v("下面针对默认配置文件中的内容进行一个详解")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("user  nobody"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("error_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("error_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("error_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("pid        logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("access_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("tcp_nopush     on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("gzip  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("charset koi8"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("access_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("error_page  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404.")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" redirect server error pages to the static page "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n        error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" proxy the PHP scripts to Apache listening on "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    proxy_pass   http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" pass the PHP scripts to FastCGI server listening on "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    root           html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    fastcgi_pass   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    fastcgi_index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    fastcgi_param  SCRIPT_FILENAME  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scripts$fastcgi_script_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    include        fastcgi_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" deny access to "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htaccess files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" Apache's document root\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" concurs with nginx's one\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ht")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    deny  all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" another virtual host using mix of IP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("based configuration\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    listen       somename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    server_name  somename  alias  another"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alias"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("        root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("        index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" HTTPS server\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_certificate      cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_certificate_key  cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_session_cache    shared"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("SSL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_session_timeout  5m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_ciphers  HIGH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("!aNULL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("!MD5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    ssl_prefer_server_ciphers  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("        root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("        index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br")])]),n("h3",{attrs:{id:"user"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[s._v("#")]),s._v(" user")]),s._v(" "),n("p",[n("code",[s._v("user nobody")]),s._v("：由操作系统的哪一个用户来执行指令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef | grep nginx")]),s._v("\nroot     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10108")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":31 ?        00:00:00 nginx: master process ./nginx\nnobody   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10965")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10108")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":27 ?        00:00:00 nginx: worker process\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("可以看到 worker 是 nobody 运行的，而 master 是 root，是因为 nginx 是我们主动运行的。")]),s._v(" "),n("p",[s._v("不同用户的进程，它对于操作系统的权限是不一样的（最明显的是文件的权限）")]),s._v(" "),n("h3",{attrs:{id:"worker-processes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#worker-processes"}},[s._v("#")]),s._v(" worker_processes")]),s._v(" "),n("p",[s._v("配置几个 worker 服务，一般配置为 CPU 核心数，或则未核心数 减 1")]),s._v(" "),n("h3",{attrs:{id:"error-log"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#error-log"}},[s._v("#")]),s._v(" error_log")]),s._v(" "),n("p",[s._v("配置错误的日志，文件后面的为日志级别")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[s._v("error_log    logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nerror_log    logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log    notice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nerror_log    logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log    info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("日志级别从低到高分别是：debug、info、notice、warn、error、crit")]),s._v(" "),n("p",[s._v("默认日志文件地址在我们安装的时候通过 "),n("code",[s._v("--error-log-path=/var/log/nginx/xx.log")]),s._v(" 指定了，我们不配置的话，它自己也有默认文件地址的")]),s._v(" "),n("h3",{attrs:{id:"pid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pid"}},[s._v("#")]),s._v(" pid")]),s._v(" "),n("p",[s._v("运行时的进程 ID 文件")]),s._v(" "),n("h3",{attrs:{id:"events"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#events"}},[s._v("#")]),s._v(" events")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("events {\n\t\t# 默认使用 epoll，在 linux 下最合适的就是 epoll，其他平台上可能不一样\n    use epoll;\n    # 每个 worker 允许连接的客户端最大连接数\n    worker_connections  1024;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"http"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[s._v("#")]),s._v(" http")]),s._v(" "),n("p",[s._v("网络传输相关的模块，是一个指令块")]),s._v(" "),n("h4",{attrs:{id:"include"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#include"}},[s._v("#")]),s._v(" include")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("include mime.types;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("在 nginx.conf 同级目录下，有一个 mime.types 文件，里面也是一个指令块内容，包含了很多的 mime type")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@study conf]# cat mime.types\n\ntypes {\n    text/html                                        html htm shtml;\n    text/css                                         css;\n    text/xml                                         xml;\n    image/gif                                        gif;\n...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("同理，include 就可以导入你自己的其他配置文件了，通过它来进行分类重用之类的工作")]),s._v(" "),n("h4",{attrs:{id:"log-format"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#log-format"}},[s._v("#")]),s._v(" log_format")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("access_log  logs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("需要配合 access_log 使用，log_format 是日志格式的指定，记录的是 http 请求相关的日志信息")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /var/log/nginx/access.log ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.1 - - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("04/Apr/2021:16:32:44 +0800"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("612")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.1 - - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("04/Apr/2021:16:32:44 +0800"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /favicon.ico HTTP/1.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.56.105/"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("如上所以的日志格式，就是被注释的默认格式所格式化出来的")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("remote_addr")]),s._v("：ip 地址")]),s._v(" "),n("li",[n("code",[s._v("remote_user")]),s._v("：远程用户，一般都是横杠 "),n("code",[s._v("-")]),s._v(" 表示无法获取")]),s._v(" "),n("li",[n("code",[s._v("time_local")]),s._v("：访问时间")]),s._v(" "),n("li",[n("code",[s._v("request")]),s._v("：访问方法和地址还有协议")]),s._v(" "),n("li",[n("code",[s._v("status")]),s._v("：响应状态")]),s._v(" "),n("li",[n("code",[s._v("body_bytes_sent")]),s._v("：响应内容的大小")]),s._v(" "),n("li",[n("code",[s._v("http_referer")]),s._v("：用是从哪一个链接跳转过来的")]),s._v(" "),n("li",[n("code",[s._v("http_user_agent")]),s._v("：用户代理，一般写的浏览器")]),s._v(" "),n("li",[n("code",[s._v("http_x_forwarded_for")]),s._v("：客户端 IP，通过代理转发后的 IP")])]),s._v(" "),n("h4",{attrs:{id:"sendfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sendfile"}},[s._v("#")]),s._v(" sendfile")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sendfile        on;\n#tcp_nopush     on;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("文件高效传输，而 tcp_nopush 需要配合 sendfile 一起使用，含义是：当数据包内容累积到一定大小的时候才会发送，相当于是定义缓存")]),s._v(" "),n("h4",{attrs:{id:"keepalive-timeout"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalive-timeout"}},[s._v("#")]),s._v(" keepalive_timeout")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    #keepalive_timeout  0;\n    keepalive_timeout  65;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("客户端链接服务端超时的时间，http 协议里面的东西，保持长链接的空闲时间，这里单位是秒")]),s._v(" "),n("h4",{attrs:{id:"gzip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip"}},[s._v("#")]),s._v(" gzip")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#gzip  on;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("gzip 压缩开关")]),s._v(" "),n("h4",{attrs:{id:"server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[s._v("#")]),s._v(" server")]),s._v(" "),n("p",[s._v("server 也就是虚拟主机")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("ul",[n("li",[s._v("listen：监听端口")]),s._v(" "),n("li",[s._v("server_name：可以定义 IP 或则域名")]),s._v(" "),n("li",[s._v("location：路由")]),s._v(" "),n("li",[s._v("error_page：发生错误的时候，使用这里响应的状态码页面展示")])]),s._v(" "),n("h3",{attrs:{id:"pid-打开失败及解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pid-打开失败及解决方案"}},[s._v("#")]),s._v(" pid 打开失败及解决方案")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./sbin/nginx -s reload")]),s._v("\nnginx: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" open"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/nginx/nginx.pid"')]),s._v(" failed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("其实打开这个文件失败，解决办法呢，就是先去看看这个路径的文件是否存在：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("如果是 "),n("code",[s._v("/var/run/nginx/")]),s._v(" 不存在，则创建这个目录就好了")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/run/nginx/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("目录存在之后，再次尝试重启，报错 pid 无效")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('./sbin/nginx -s reload\nnginx: [error] invalid PID number "" in "/var/run/nginx/nginx.pid"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("解决如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./sbin/nginx -h")]),s._v("\nnginx version: nginx/1.16.1\nUsage: nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-?hvVtTq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-s signal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-c filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-p prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-g directives"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nOptions:\n  -?,-h         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" this "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n  -v            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" show version and "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n  -V            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" show version and configure options "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n  -t            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" configuration and "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n  -T            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" configuration, dump it and "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n  -q            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" suppress non-error messages during configuration testing\n  -s signal     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" send signal to a master process: stop, quit, reopen, reload\n  -p prefix     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" prefix path "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default: /usr/local/nginx/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -c filename   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default: conf/nginx.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -g directives "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global directives out of configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("查看下 nginx 的帮助，看到有一个 "),n("code",[s._v("-c")]),s._v(" 的选项，手动选择配置文件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("./sbin/nginx -c /usr/local/nginx/conf/nginx.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次重启就可以了")]),s._v("\n./sbin/nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("nginx 在运行期间，这个 pid 文件丢失的话，就会出现上面的情况，执行信号指令就会报错，这个时候就只能先 kill 掉 master 进程，再手动指定下配置文件运行后，就可以了。")]),s._v(" "),n("p",[s._v("这个 pid 文件只有在运行时才会产生")])])])]),s._v(" "),n("h2",{attrs:{id:"常用命令解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令解析"}},[s._v("#")]),s._v(" 常用命令解析")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("stop：暴力停止类似 kill")]),s._v(" "),n("p",[n("code",[s._v("./nginx -s stop")])])]),s._v(" "),n("li",[n("p",[s._v("quit：优雅的关闭，有连接存在的话，会等待连接释放后再关闭，同时不再接受新的请求，"),n("strong",[s._v("仅针对 http 请求有效")])]),s._v(" "),n("p",[n("code",[s._v("./nginx -s quit")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("-t")]),s._v("：测试验证配置文件是否有问题")]),s._v(" "),n("p",[n("code",[s._v("./nginx -t")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("-v")]),s._v("：nginx 版本号")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("  ./nginx -v\n  nginx version: nginx/1.16.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("-V")]),s._v(" ：可以将编译时的配置参数大打印出来")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("  ./nginx -V\n  nginx version: nginx/1.16.1\n  built by gcc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20150623")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Red Hat "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".5-44"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GCC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  configure arguments: --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --pid-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx/nginx.pid --lock-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lock/nginx.lock --error-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/error.log --http-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/access.log --with-http_gzip_static_module --http-client-body-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/temp/nginx/client --http-proxy-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/temp/nginx/proxy --http-fastcgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/temp/nginx/fastcgi --http-uwsgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/temp/nginx/uwsgi --http-scgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/temp/nginx/scgi\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("-c")]),s._v("：指定配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./nginx -c /usr/con/con.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"nginx-日志切割-手动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-日志切割-手动"}},[s._v("#")]),s._v(" Nginx 日志切割-手动")]),s._v(" "),n("p",[s._v("前面配置了  nginx 的日志文件路径 "),n("code",[s._v("/var/log/nginx/access.log")]),s._v("，随着时间的增加，日志内容会越来越多，不方便查看，可以以时间为单位将文件进行切割")]),s._v(" "),n("ol",[n("li",[s._v("创建 shell 脚本文件 "),n("code",[s._v("cut_my_log.sh")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOG_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/nginx/"')]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RECORD_TIME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yesterday"')]),s._v(" +%Y-%m-%d+%H:%M"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx/nginx.pid \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_PATH}")]),s._v("/access.log "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_PATH}")]),s._v("/access."),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${RECORD_TIME}")]),s._v(".log \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_PATH}")]),s._v("/error.log "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_PATH}")]),s._v("/error."),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${RECORD_TIME}")]),s._v(".log \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#向Nginx主进程发送信号，用于重新打开日志文件 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -USR1 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $PID"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[s._v("添加可执行权限")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u+x cut_my_log.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("执行脚本，查看结果")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("./cut_my_log.sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查结果：可以看到按时间命名了")]),s._v("\nll /var/log/nginx/\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root   root  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("428")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":32 access.2021-04-03+22:02.log\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody root    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":02 access.log\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root   root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2143")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":15 error.2021-04-03+22:02.log\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody root    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":02 error.log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])])]),s._v(" "),n("p",[s._v("生成的文件名是这句代码 "),n("code",[s._v('RECORD_TIME=$(date -d "yesterday" +%Y-%m-%d+%H:%M)')]),s._v("，这里是按照分为单位生成的，可以修改它按天、小时之类的切割")]),s._v(" "),n("h2",{attrs:{id:"nginx-日志切割-定时"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-日志切割-定时"}},[s._v("#")]),s._v(" Nginx 日志切割-定时")]),s._v(" "),n("p",[s._v("使用 crontab 来定时执行脚本，某些 linux 已经自带了，如果没有自带可以安装再配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nyum instal crontabs\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -e 增加下面一行配置，文件使用绝对路径指向刚刚的脚本文件")]),s._v("\n*/1 * * * * /usr/local/nginx/sbin/cut_my_log.sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启定时任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" crond restart\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("定时任务的常用命令：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("service crond start //启动服务 service crond stop //关闭服务 service crond restart //重启服务 service crond reload //重新载入配置 crontab -e // 编辑任务 crontab -l // 查看任务列表\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("定时任务表达式：")])]),s._v(" "),n("p",[s._v("Cron表达式是，分为5或6个域，每个域代表一个含义，如下所示：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th"),s._v(" "),n("th",[s._v("分")]),s._v(" "),n("th",[s._v("时")]),s._v(" "),n("th",[s._v("日")]),s._v(" "),n("th",[s._v("月")]),s._v(" "),n("th",[s._v("星期几")]),s._v(" "),n("th",[s._v("年（可选）")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("取值范围")]),s._v(" "),n("td",[s._v("0-59")]),s._v(" "),n("td",[s._v("0-23")]),s._v(" "),n("td",[s._v("1-31")]),s._v(" "),n("td",[s._v("1-12")]),s._v(" "),n("td",[s._v("1-7")]),s._v(" "),n("td",[s._v("2019/2020/2021/…")])])])]),s._v(" "),n("p",[s._v("如：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每分钟执行")]),s._v("\n*/1 * * * *\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每日凌晨（每天晚上23:59）执行：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" * * *\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每日凌晨1点执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" * * *\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"配置-nginx-为静态资源提供服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-为静态资源提供服务"}},[s._v("#")]),s._v(" 配置 Nginx 为静态资源提供服务")]),s._v(" "),n("p",[s._v("发布静态资源作为一个服务，供用户使用")]),s._v(" "),n("p",[s._v("我们可以这样做，创建一个 "),n("code",[s._v("/usr/local/nginx/conf/my.conf")]),s._v("  的文件，里面写指令，再在默认的配置文件里面 include 进去，分离我们自己的脚本文件的方式来组织配置")]),s._v(" "),n("p",[s._v("my.conf")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n   location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       root   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("foodie"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       index  index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("在默认的配置文件中  include 我们的配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n\t\t...\n    include my.conf;\n    ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("重新加载 nginx")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("以上配置，我们将我们前端项目使用 nginx 部署了，这个时候可以访问 "),n("code",[s._v("http://192.168.56.105:90/")]),s._v(" 就能访问到前端项目了")]),s._v(" "),n("p",[s._v("另外还可以将图片等文件配置成服务，比如 "),n("code",[s._v("/home/foodie-shop/images")]),s._v(" 下有很多图片")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("   location  /images{\n       root   /home/foodie-shop;\n   }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("注：这里只是为了演示，因为这个目录在 "),n("code",[s._v("/")]),s._v(" 下可以直接访问的 "),n("code",[s._v("http://192.168.56.105:90/images/header-bg1.jpg")])]),s._v(" "),n("p",[s._v("上述配置后，访问 "),n("code",[s._v("http://192.168.56.105:90/images/header-bg1.jpg")]),s._v("，它打开的文件是 "),n("code",[s._v("/home/foodie-shop/images/header-bg1.jpg")])]),s._v(" "),n("p",[s._v("这种方式需要注意的是：root + location + 请求的资源链接起来要是一个主机上存在的物理路径。")]),s._v(" "),n("p",[s._v("那么还可以使用 "),n("strong",[s._v("别名（alias）")]),s._v(" 的方式进行映射，如下所示")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置路由规则")]),s._v("\n   location /i2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   \t\t "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 资源所在的物理路径")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v("   /home/foodie-shop/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("访问路径变成了 "),n("code",[s._v("http://192.168.56.105:90/i2/header-bg1.jpg")]),s._v("，也就是说 "),n("code",[s._v("/i2")]),s._v(" 会被转成 "),n("code",[s._v("/home/foodie-shop/images")]),s._v(" 最后拼接成完成的资源物理路径")]),s._v(" "),n("h2",{attrs:{id:"使用-gzip-压缩提升传输效率"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-gzip-压缩提升传输效率"}},[s._v("#")]),s._v(" 使用 Gzip 压缩提升传输效率")]),s._v(" "),n("p",[s._v("访问网站首页，按 size 倒序排列，看到最大的一个文件是 css 文件，我们使用压缩在降低它的大小")]),s._v(" "),n("p",[n("img",{attrs:{src:t(517),alt:"image-20210405115611359"}})]),s._v(" "),n("p",[s._v("在 http 指令块中增加配置")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 开启 gzip 压缩功能，目的：提高传输效率，节约带宽\n\tgzip    on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 限制最小压缩，小于 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 字节的文件不会压缩\n\tgzip_min_length    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 定义压缩级别（压缩比例）\n\tgzip_comp_level    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 定义需要压缩的文件类型\n\tgzip_types text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plain text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("json application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("rss text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("重新加载配置后，查看效果")]),s._v(" "),n("p",[n("img",{attrs:{src:t(518),alt:"image-20210405120356983"}})]),s._v(" "),n("p",[s._v("可以看到从 344 KB 压缩成了 61.2 KB")]),s._v(" "),n("h2",{attrs:{id:"location-匹配规则解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location-匹配规则解析"}},[s._v("#")]),s._v(" location 匹配规则解析")]),s._v(" "),n("h3",{attrs:{id:"默认匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#默认匹配"}},[s._v("#")]),s._v(" 默认匹配")]),s._v(" "),n("p",[s._v("默认的规则，比如请求 "),n("code",[s._v("http://192.168.56.105:90/")]),s._v(" 是可以访问到网站首页的")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("   location / {\n       root   /home/foodie-shop/;\n       index  index.html;\n   }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"精准匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#精准匹配"}},[s._v("#")]),s._v(" 精准匹配")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("   location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       root   /home/foodie-shop/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       index  index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这个规则，配置后，就访问不到网站首页了，因为只会匹配 "),n("code",[s._v("/")]),s._v(" 但是这里会找 index.html")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("   location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /index.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       root   /home/foodie-shop/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       index  index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这样配置后，就可以访问到网站首页了，但是其他的资源不能访问，因为只匹配了 index.html")]),s._v(" "),n("h3",{attrs:{id:"正则匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正则匹配"}},[s._v("#")]),s._v(" 正则匹配")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 波浪符号开头表示使用正则表达式\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" 表示不区分大小写\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 转义 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 号元字符为普通字符\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 分组里面任意一种格式 都可以路由\n   location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GIF"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("bmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       root   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("foodie"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("上面配置了一个 root 的目录，对文件后缀进行路由，所以只要这样访问就能访问到 "),n("code",[s._v("/home/foodie-shop/images")]),s._v(" 目录下的图片资源了")]),s._v(" "),n("p",[n("code",[s._v("http://192.168.56.105:91/images/header-bg1.jpg")])]),s._v(" "),n("h3",{attrs:{id:"非正则匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#非正则匹配"}},[s._v("#")]),s._v(" 非正则匹配")]),s._v(" "),n("div",{staticClass:"language-lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-lua"}},[n("code",[s._v("   location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("images")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       root   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("foodie"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("code",[s._v("^~")]),s._v("：以某个字符路径开头的请求")]),s._v(" "),n("p",[n("code",[s._v("~")]),s._v(" 表示使用正则表达式，前面用 "),n("code",[s._v("^")]),s._v(" 表示非正则，这个就感觉和普通的默认匹配类似了")])])}),[],!1,null,null,null);a.default=e.exports}}]);