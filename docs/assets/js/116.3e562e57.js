(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{908:function(a,s,t){"use strict";t.r(s);var e=t(22),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"springboot-多环境部署-profile-开发环境-生产环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springboot-多环境部署-profile-开发环境-生产环境"}},[a._v("#")]),a._v(" SpringBoot 多环境部署 profile(开发环境/生产环境)")]),a._v(" "),t("h2",{attrs:{id:"多环境部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多环境部署"}},[a._v("#")]),a._v(" 多环境部署")]),a._v(" "),t("p",[a._v("基本上有以下几个环境：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("开发环境：dev")]),a._v(" "),t("p",[a._v("开发的时候使用")])]),a._v(" "),t("li",[t("p",[a._v("测试环境：test")]),a._v(" "),t("p",[a._v("部署到测试环境使用")])]),a._v(" "),t("li",[t("p",[a._v("生产环境：prod")]),a._v(" "),t("p",[a._v("生产环境使用")])])]),a._v(" "),t("p",[a._v("还要一些公司分得细，在测试环境和生产环境中间还有一个 "),t("strong",[a._v("预发布环境")])]),a._v(" "),t("p",[a._v("分不同的环境，目的是需要修改一些配置，比如数据库配置、消息队列配置等。")]),a._v(" "),t("h2",{attrs:{id:"boot-多环境支持-profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#boot-多环境支持-profile"}},[a._v("#")]),a._v(" boot 多环境支持 profile")]),a._v(" "),t("ul",[t("li",[a._v("application.yml：主配置文件")]),a._v(" "),t("li",[t("code",[a._v("application-{name}.yml")]),a._v("：环境配置（挂件）")])]),a._v(" "),t("p",[a._v("通过配置项： "),t("code",[a._v("spring.profiles.active:{name}")]),a._v(" 来激活对应的配置文件")]),a._v(" "),t("p",[a._v("在 application.yml 中增加 dev 的激活，也就是说：默认是 dev 环境")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("profiles")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("active")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("application-prod.yml")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("datasource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//192.168.56.108"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("3306/foodie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("shop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("?")]),a._v("useUnicode=true"),t("span",{pre:!0,attrs:{class:"token important"}},[a._v("&characterEncoding=UTF-8&autoReconnect=true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" root\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("当前项目比较简单，要修改的配置文件也比较少。这里主要说配置文件技巧：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("application.yml：保留全部的配置，只有开放环境需要配置的除外")]),a._v(" "),t("p",[a._v("比如：myabtis 的日志打印，只有开放环境下需要配置，如果默认配置中也配置上了，那么在 prod 里面就无法取消了，因为如果是空值，应该会报错")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mybatis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type-aliases-package")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cn.mrcode.foodiedev.pojo    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 实体层")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mapper-locations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mapper/"),t("span",{pre:!0,attrs:{class:"token important"}},[a._v("*.xml")]),a._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mapper 层")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configuration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("log-impl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" org.apache.ibatis.logging.stdout.StdOutImpl\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("那么这种情况下如何做呢？默认配置只保留如下配置即可，剩余在在 dev 中开启，而 prod 中不需要，则不配置即可")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mybatis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type-aliases-package")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cn.mrcode.foodiedev.pojo    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 实体层")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mapper-locations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" classpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mapper/"),t("span",{pre:!0,attrs:{class:"token important"}},[a._v("*.xml")]),a._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mapper 层")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])])]),a._v(" "),t("li",[t("p",[a._v("application-dev.yml：只需要在 dev 环境下需要更改的配置")])])]),a._v(" "),t("p",[a._v("这样做的好处是：")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("当你的配置很多的时候，各种环境能比较清晰的知道哪些配置是更改了的")])]),a._v(" "),t("li",[t("p",[a._v("当新增或则减少配置时，能话最小的代价去维护")]),a._v(" "),t("p",[a._v("比如：公共配置中的配置，在 dev 和 prod 中都没有覆盖，那么只需要维护公共配置文件中的内容即可，而不需要维护所有环节的配置文件内容")])])]),a._v(" "),t("h2",{attrs:{id:"profiles-需要更改的地方梳理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#profiles-需要更改的地方梳理"}},[a._v("#")]),a._v(" profiles 需要更改的地方梳理")]),a._v(" "),t("p",[a._v("由于当前阶段项目中某些配置写得不够好，还需要手动硬编码，这里做一个梳理")]),a._v(" "),t("ol",[t("li",[a._v("在 prod 配置文件中修改的有：\n"),t("ol",[t("li",[a._v("数据源配置")]),a._v(" "),t("li",[a._v("mybatis 日志打印")])])]),a._v(" "),t("li",[a._v("项目中直接需要硬编码改变的配置有\n"),t("ol",[t("li",[t("code",[a._v("cn.mrcode.foodiedev.resource.FileUpload")]),a._v(" 图片加载的配置文件，图片存储目录和图片服务器路径")]),a._v(" "),t("li",[a._v("BaseController 中硬编码的支付中心地址、回调地址信息")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);